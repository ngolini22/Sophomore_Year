http://www.cs.dartmouth.edu/%7Ecampbell/cs60/lab4.html
3
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title></title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html --> 
<meta name="src" content="lab4.tex"> 
<meta name="date" content="2012-04-20 15:01:00"> 
<link rel="stylesheet" type="text/css" href="lab4.css"> 
</head><body 
>
<h1 class="likepartHead"><a 
 id="x1-1000"></a>CS 60 Computer Networks</h1>
<h1 class="likepartHead"><a 
 id="x1-2000"></a>Lab4</h1>
<h1 class="likepartHead"><a 
 id="x1-3000"></a>Simple Reliable Transport (SRT) - Implementing Signalling (SIG)</h1>
<!--l. 19--><p class="noindent" >In this lab, you will implement the signaling protocol for the Simple Reliable Transport (SRT), which is
part of DartNet. Lab4 does not deal with the transfer of SRT data segments. Rather, SYN, SYNACK, and
FIN, FINACK are implemented. Lab5 will deal with data transfer and specifically the implementation of a
&#8220;sliding window&#8221; protocol for efficient data transfer between the client and server (unidirectional reliable
byte stream).
<!--l. 21--><p class="noindent" >At the end of this lab you will have really good sense for how protocols such as TCP establish connections
between hosts and how the internal mechanisms resolve issue such as lost or corrupt signaling packets
(e.g., SYN is lost).
<!--l. 23--><p class="noindent" >We have already discussed the design of SRT and how it fits into DartNet.
<!--l. 26--><p class="noindent" ><span 
class="cmbx-10">Before you read another line of this programming assignment please read or re-read the</span>
<span 
class="cmbx-10">Lecture 11&#8217;s notes on </span><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt.html" > <span 
class="cmbx-10">SRT design </span></a><span 
class="cmbx-10">. </span><br 
class="newline" />
<!--l. 29--><p class="noindent" >While quite a lot of information is given on APIs, data structures, connection management, and FSMs
you will need to think about how to implement the SRT function calls as part of the SRT
layer.
<!--l. 31--><p class="noindent" ><span 
class="cmbx-10">Submitting assignment</span>:
<!--l. 33--><p class="noindent" >Use svn as normal.
<!--l. 35--><p class="noindent" >Please make sure that the lab4 directory contains a simple text file, named README, describing anything
&#8220;unusual&#8221; about how your solutions should be located, executed, and considered; and a Makefile to build
the source.
<!--l. 37--><p class="noindent" >Your lab4 should have the following structure and files.
<!--l. 39--><p class="noindent" >[atc@dhcp-212-223 lab4] ls * <br 
class="newline" />Makefile ReadMe<br 
class="newline" />
<!--l. 42--><p class="noindent" >client:<br 
class="newline" />app_client.c srt_client.c srt_client.h<br 
class="newline" />
                                                                                  
                                                                                  
<!--l. 45--><p class="noindent" >common:<br 
class="newline" />constants.h seg.c seg.h<br 
class="newline" />
<!--l. 48--><p class="noindent" >server:<br 
class="newline" />app_server.c srt_server.c srt_server.h <br 
class="newline" />
<!--l. 52--><p class="noindent" >____________________________________________________________________________
<h3 class="likesectionHead"><a 
 id="x1-4000"></a>Important source and header files - read them </h3>
<!--l. 56--><p class="noindent" >OK, now you have read the design notes, look at these important files - browse them for now, we will be
back.
<!--l. 60--><p class="noindent" ><span 
class="cmbx-10">Note, all the files listed below plus other files (e.g., makefile, README, etc.) needed for this</span>
<span 
class="cmbx-10">lab can be found in this tarball file: </span><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/lab4handout.tar.gz" > <span 
class="cmbx-10">lab4handout.tar.gz </span></a><span 
class="cmbx-10">. Save this and work from this</span>
<span 
class="cmbx-10">tarball for your assignment</span>.
<!--l. 62--><p class="noindent" >There are a number of files that show examples of the app_client.c and app_server.c that show the SRT
Socket API. In addition, we provide a number of header files that define constants used by SRT that you
should include in your code.
<!--l. 65--><p class="noindent" >The challenge of this lab is to implement the function calls used by app_client.c and app_server.c. So take
a look at those example application files. This is very similar to the C socket programming we have done
alreay. <span 
class="cmbx-10">The functions will be implemented in the srt</span><span 
class="cmbx-10">_client.c and srt</span><span 
class="cmbx-10">_server.c code;</span>
<span 
class="cmbx-10">the skeleton code for these two files is given below (but use the tarball above, as</span>
<span 
class="cmbx-10">source).</span>
<!--l. 67--><p class="noindent" >So, let&#8217;s look at the files now:
<!--l. 69--><p class="noindent" >Clients application - examples of client using SRT Socket API.
<!--l. 71--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/app_client.c" > app_client.c</a>. <br 
class="newline" />
<!--l. 73--><p class="noindent" >Client side data structures and prototypes needed to implement the client side SRT protocol
<!--l. 75--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt_client.h" > srt_client.h</a>. <br 
class="newline" />
<!--l. 77--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt_client.c" > srt_client.c</a>. <br 
class="newline" />
<!--l. 79--><p class="noindent" >Server application - examples of server side SRT Socket API.
<!--l. 81--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/app_server.c" > app_server.c</a>. <br 
class="newline" />
<!--l. 83--><p class="noindent" >Server side data structures and prototypes needed to implement the server side SRT protocol
<!--l. 85--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt_server.h" > srt_server.h</a>. <br 
class="newline" />
                                                                                  
                                                                                  
<!--l. 87--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt_server.c" > srt_server.c</a>. <br 
class="newline" />
<!--l. 89--><p class="noindent" >SNP APIs - header file. SRT header and segement data structure, SNP prototypes.
<!--l. 91--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/seg.h" > seg.h</a>. <br 
class="newline" />
<!--l. 93--><p class="noindent" >Constants
<!--l. 95--><p class="noindent" ><a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/constants.h" > constants.h</a>. <br 
class="newline" />
<!--l. 98--><p class="noindent" >
<h3 class="likesectionHead"><a 
 id="x1-5000"></a>Coding FSMs</h3>
<!--l. 100--><p class="noindent" >Please familiarize yourself with the following in the <a 
href="http://www.cs.dartmouth.edu/~campbell/cs60/srt.html" > SRT design document: </a>.
<!--l. 102--><p class="noindent" >1) Connection set up and tear down diagrams.
<!--l. 104--><p class="noindent" >2) The SRT client and server side FSMs.
<!--l. 106--><p class="noindent" >You will need to make sure that in all the code that you write (which is essentially all the SRT function
calls in Fig. 1) you drive the code as a state machine. For example, consider the following code
snippet:
<div 
class="colorbox" id="colorbox1"><div class="BVerbatimInput"><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_disconnect(int</span><span 
class="cmtt-10">&#x00A0;sockfd)</span><span 
class="cmtt-10">&#x00A0;{</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;client_tcb_t</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;*tp;</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;tp=gettcb(sockfd);</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;(tp</span><span 
class="cmtt-10">&#x00A0;==</span><span 
class="cmtt-10">&#x00A0;NULL)</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;-1;</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;switch(tp-&#x003E;state)</span><span 
class="cmtt-10">&#x00A0;{</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;CLOSED:</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;......;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;break;</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;SYNSENT:</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;......;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;break;</span><br /><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;CONNECTED:</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;......;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;break;</span><br /><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;FINWAIT:</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;......;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;break;</span><br /><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;default:</span><br /><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;}</span><br /><br /><span 
class="cmtt-10">}</span><br /></div></div>
<!--l. 157--><p class="noindent" >This gives a simple and clean way to write code that is state machine driven. Try and use this style
consistently in your solution. Many of the SRT functions you have to write can have a structure
like this. There are some exceptions. The snp_sendseg() and snp_recvseg() do not have to
embedd SRT FSM information. However, snp_recvseg() is complicated by the fact that it
has to parse bytes streams in search of the special start &#8220;!&amp;&#8221; and end &#8220;!#&#8221; characters as
delimiters of a segment (SYN, SYNACK, FIN, FINACK). A good way to implement this parser
of bytes to find the start of a segment and then end - is to design a little FSM for handing
incoming bytes and keeping state on the stream in snp_recvseg(). Just an idea - many ways to do
this.
<!--l. 159--><p class="noindent" >
<h3 class="likesectionHead"><a 
 id="x1-6000"></a>SRT Functions to Implement</h3>
<!--l. 161--><p class="noindent" >Fig.<a 
href="#x1-60011">1<!--tex4ht:ref: lab4calls --></a>) shows that the SRT runs directly on the overlay and not over SNP which will be our final goal in a
future lab. You assignment revolves around implementing all the functions shown in the diagram. When
you look at the client and server FSMs you will see TIMEOUTs for retransmitting packets. How are you
going to implement timers? How does your client side and server side break down into threads. Ask
                                                                                  
                                                                                  
yourself what is the minimal number of threads needed to implement the client and server
side.
<!--l. 163--><p class="noindent" >Note, that the SRT sits directly on the &#8220;thin&#8221; overlay layer for Lab4. The overlay in this case simply
implements a TCP connection between the client and server SRT transport protocols. The overlay just
contains a direct TCP connection between the client and the server. The <span 
class="cmbx-10">overlay</span><span 
class="cmbx-10">_start() </span>and
<span 
class="cmbx-10">overlay</span><span 
class="cmbx-10">_stop() </span>functions create the drect TCP connection between the client and the server.
overlay_start() should return the TCP socket descriptor. overlay_stop() closes the TCP connection. The
code needed to do this is essentially the C code we developed for the socket programming
assignment. Therefore, you already have 90% of the code for the overlay. For lab4, the API
functions need to implement are shown in Fig. 1. These are a subset of the DartNet API function
calls.
<!--l. 165--><p class="noindent" >You will need to implement <span 
class="cmbx-10">SNP</span><span 
class="cmbx-10">_sendseg() </span>and <span 
class="cmbx-10">SNP</span><span 
class="cmbx-10">_recvseg() </span>function calls to send and
receive segments using the overlay&#8217;s TCP connection. In the case of TCP data is sent as byte
stream. Note, in order to send data segments over the overlay TCP connection, we need to add
delimiters in the byte stream. In SRT uses the special characters &#8220;!&amp;&#8221; to indicate the start of
a segment and the special characters &#8220;!#&#8221; to indicate the end of a segment. Two notes on
these delimiters. First, these characters should not occur in the data sent between the client
and the service. This is a restriction (and the protocol would operate incorrectly if &#8220;!&amp;&#8221; or
&#8220;!#&#8221; were to occur in the byte stream from the client. So you should make sure your data
does not include these pairs of special control characters. Second, delimiters are necessary
because the receiving side of a STR packet (i.e., STR header + STR segment) needs to know
when it successfully receives an SRT packet. This is one way to do it. Probably the simplest
approach.
<!--l. 167--><p class="noindent" >Because the overlay is built from TCP rather than say UDP we do not have any loss. To allow the
overlay to look as if it runs across lossy links and that packets can be lost in the Internet we
implement loss() function invoked in <span 
class="cmbx-10">SNP</span><span 
class="cmbx-10">_recvseg() </span>when an SRT packet is received to discard
the segment with probability PKT_LOSS_RATE to simulate the packet loss to force SRT
to recover the missing segments which can be SRT DATA packets, SYN, SYNACK, FIN,
and FINACK. The SRT protocol must be able to recover correctly from loss of any of these
packets.
<!--l. 170--><p class="noindent" ><hr class="figure"><div class="figure" 
>
                                                                                  
                                                                                  
<a 
 id="x1-60011"></a>
                                                                                  
                                                                                  
<!--l. 172--><p class="noindent" ><img 
src="lab40x.png" alt="PIC" class="graphics" width="599.84122pt" height="327.42973pt" ><!--tex4ht:graphics  
name="lab40x.png" src="lab4calls.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">The Lab4 API Function Calls to Implement</span></div><!--tex4ht:label?: x1-60011 -->
                                                                                  
                                                                                  
<!--l. 175--><p class="noindent" ></div><hr class="endfigure">
<!--l. 177--><p class="noindent" >See the design document for more details on all the function calls. We do go into this below with more
specifics than the design notes.
<h3 class="likesectionHead"><a 
 id="x1-7000"></a>SRT client-side prototypes</h3>
<!--l. 181--><p class="noindent" >In what follows, we provide more details on each of the client-side prototypes you will implement. These
are just guidelines you are free to implement the protocol as you like.
<div 
class="colorbox" id="colorbox2"><div class="BVerbatimInput"><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;SRT</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;API</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;side</span><span 
class="cmtt-10">&#x00A0;application.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;===================================</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;In</span><span 
class="cmtt-10">&#x00A0;what</span><span 
class="cmtt-10">&#x00A0;follows,</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;provide</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;prototype</span><span 
class="cmtt-10">&#x00A0;definition</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;each</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;limited</span><span 
class="cmtt-10">&#x00A0;pseudo</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;representation</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function.</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;meant</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;comprehensive</span><span 
class="cmtt-10">&#x00A0;-</span><span 
class="cmtt-10">&#x00A0;more</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;guideline.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;free</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;wish.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;NOTE:</span><span 
class="cmtt-10">&#x00A0;When</span><span 
class="cmtt-10">&#x00A0;designing</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;functions</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;consider</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;possible</span><span 
class="cmtt-10">&#x00A0;states</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;using</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;switch</span><span 
class="cmtt-10">&#x00A0;statement</span><span 
class="cmtt-10">&#x00A0;(see</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;Lab4</span><span 
class="cmtt-10">&#x00A0;assignment</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;example).</span><span 
class="cmtt-10">&#x00A0;Typically,</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;has</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;certain</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;determined</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;carry</span><span 
class="cmtt-10">&#x00A0;out</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;certain</span><span 
class="cmtt-10">&#x00A0;action.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">void</span><span 
class="cmtt-10">&#x00A0;srt_client_init(int</span><span 
class="cmtt-10">&#x00A0;conn);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;initializes</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;marking</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;entries</span><span 
class="cmtt-10">&#x00A0;NULL.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;also</span><span 
class="cmtt-10">&#x00A0;initializes</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;global</span><span 
class="cmtt-10">&#x00A0;variable</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;descriptor</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;conn&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;input</span><span 
class="cmtt-10">&#x00A0;parameter</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;snp_sendseg</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;snp_recvseg.</span><span 
class="cmtt-10">&#x00A0;Finally,</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;starts</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;seghandler</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;to</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;handle</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><span 
class="cmtt-10">&#x00A0;segments.</span><span 
class="cmtt-10">&#x00A0;There</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;only</span><span 
class="cmtt-10">&#x00A0;one</span><span 
class="cmtt-10">&#x00A0;seghandler</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;side</span><span 
class="cmtt-10">&#x00A0;which</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;handles</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;connections</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_sock(unsigned</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;client_port);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;looks</span><span 
class="cmtt-10">&#x00A0;up</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;find</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;first</span><span 
class="cmtt-10">&#x00A0;NULL</span><span 
class="cmtt-10">&#x00A0;entry,</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;creates</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;new</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;using</span><span 
class="cmtt-10">&#x00A0;malloc()</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;entry.</span><span 
class="cmtt-10">&#x00A0;All</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;initialized</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;e.g.,</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;set</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;CLOSED</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;port</span><span 
class="cmtt-10">&#x00A0;set</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;parameter</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;port.</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;index</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;returned</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;new</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;identify</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;side.</span><span 
class="cmtt-10">&#x00A0;If</span><span 
class="cmtt-10">&#x00A0;no</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TC</span><span 
class="cmtt-10">&#x00A0;table</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;available</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;returns</span><span 
class="cmtt-10">&#x00A0;-1.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_connect(int</span><span 
class="cmtt-10">&#x00A0;socked,</span><span 
class="cmtt-10">&#x00A0;unsigned</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;server_port);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;connect</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;takes</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;the</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;server&#8217;s</span><span 
class="cmtt-10">&#x00A0;port</span><span 
class="cmtt-10">&#x00A0;number</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;input</span><span 
class="cmtt-10">&#x00A0;parameters.</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;find</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;sets</span><span 
class="cmtt-10">&#x00A0;up</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB&#8217;s</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;port</span><span 
class="cmtt-10">&#x00A0;number</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;SYN</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;to</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;using</span><span 
class="cmtt-10">&#x00A0;snp_sendseg().</span><span 
class="cmtt-10">&#x00A0;After</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;SYN</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;sent,</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;timer</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;started.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;If</span><span 
class="cmtt-10">&#x00A0;no</span><span 
class="cmtt-10">&#x00A0;SYNACK</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received</span><span 
class="cmtt-10">&#x00A0;after</span><span 
class="cmtt-10">&#x00A0;SYNSEG_TIMEOUT</span><span 
class="cmtt-10">&#x00A0;timeout,</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;SYN</span><span 
class="cmtt-10">&#x00A0;is</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;retransmitted.</span><span 
class="cmtt-10">&#x00A0;If</span><span 
class="cmtt-10">&#x00A0;SYNACK</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received,</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;1.</span><span 
class="cmtt-10">&#x00A0;Otherwise,</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;number</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;SYNs</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;sent</span><span 
class="cmtt-10">&#x00A0;&#x003E;</span><span 
class="cmtt-10">&#x00A0;SYN_MAX_RETRY,</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;transition</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;CLOSED</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;-1.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_send(int</span><span 
class="cmtt-10">&#x00A0;sockfd,</span><span 
class="cmtt-10">&#x00A0;void*</span><span 
class="cmtt-10">&#x00A0;data,</span><span 
class="cmtt-10">&#x00A0;unsigned</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;length);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Send</span><span 
class="cmtt-10">&#x00A0;data</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;srt</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;do</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;need</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;implement</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;Lab4.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;We</span><span 
class="cmtt-10">&#x00A0;will</span><span 
class="cmtt-10">&#x00A0;use</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;Lab5</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;implement</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;Go-Back-N</span><span 
class="cmtt-10">&#x00A0;sliding</span><span 
class="cmtt-10">&#x00A0;window.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_disconnect(int</span><span 
class="cmtt-10">&#x00A0;sockfd);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;disconnect</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;takes</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;as</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;input</span><span 
class="cmtt-10">&#x00A0;parameter.</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;find</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;sends</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;FIN</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;After</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FIN</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;sent</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;transition</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;FINWAIT</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;timer</span><span 
class="cmtt-10">&#x00A0;started.</span><span 
class="cmtt-10">&#x00A0;If</span><span 
class="cmtt-10">&#x00A0;the</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;==</span><span 
class="cmtt-10">&#x00A0;CLOSED</span><span 
class="cmtt-10">&#x00A0;after</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;timeout</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FINACK</span><span 
class="cmtt-10">&#x00A0;was</span><span 
class="cmtt-10">&#x00A0;successfully</span><span 
class="cmtt-10">&#x00A0;received.</span><span 
class="cmtt-10">&#x00A0;Else,</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;after</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;number</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;retries</span><span 
class="cmtt-10">&#x00A0;FIN_MAX_RETRY</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;still</span><span 
class="cmtt-10">&#x00A0;FINWAIT</span><span 
class="cmtt-10">&#x00A0;then</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;transitions</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;CLOSED</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;-1</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;returned.</span><br /><br /><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_client_close(int</span><span 
class="cmtt-10">&#x00A0;sockfd);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;calls</span><span 
class="cmtt-10">&#x00A0;free()</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;free</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;marks</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;NULL</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;returns</span><span 
class="cmtt-10">&#x00A0;1</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;succeeded</span><span 
class="cmtt-10">&#x00A0;(i.e.,</span><span 
class="cmtt-10">&#x00A0;was</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;right</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;complete</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;close)</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;-1</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;fails</span><span 
class="cmtt-10">&#x00A0;(i.e.,</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;wrong</span><span 
class="cmtt-10">&#x00A0;state).</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">void</span><span 
class="cmtt-10">&#x00A0;*seghandler(void*</span><span 
class="cmtt-10">&#x00A0;arg);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;started</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;srt_client_init().</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;handles</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;segments</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;seghanlder</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;infinite</span><span 
class="cmtt-10">&#x00A0;loop</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;calls</span><span 
class="cmtt-10">&#x00A0;snp_recvseg().</span><span 
class="cmtt-10">&#x00A0;If</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;snp_recvseg()</span><span 
class="cmtt-10">&#x00A0;fails</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;closed</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;terminated.</span><span 
class="cmtt-10">&#x00A0;Depending</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;(based</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><span 
class="cmtt-10">&#x00A0;segment)</span><span 
class="cmtt-10">&#x00A0;various</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;actions</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;taken.</span><span 
class="cmtt-10">&#x00A0;See</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;more</span><span 
class="cmtt-10">&#x00A0;details.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><br /></div></div>
<!--l. 287--><p class="noindent" >
<h3 class="likesectionHead"><a 
 id="x1-8000"></a>SRT server-side prototypes</h3>
<!--l. 289--><p class="noindent" >In what follow we provide more details on each of the server-side prototypes you will implement. These are
just guidelines you are free to implement the protocol as you like.
<div 
class="colorbox" id="colorbox3"><div class="BVerbatimInput"><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;SRT</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;API</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;side</span><span 
class="cmtt-10">&#x00A0;application.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;===================================</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;In</span><span 
class="cmtt-10">&#x00A0;what</span><span 
class="cmtt-10">&#x00A0;follows,</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;provide</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;prototype</span><span 
class="cmtt-10">&#x00A0;definition</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;each</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;limited</span><span 
class="cmtt-10">&#x00A0;pseudo</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;representation</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function.</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;meant</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;comprehensive</span><span 
class="cmtt-10">&#x00A0;-</span><span 
class="cmtt-10">&#x00A0;more</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;guideline.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;free</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;wish.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;NOTE:</span><span 
class="cmtt-10">&#x00A0;When</span><span 
class="cmtt-10">&#x00A0;designing</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;functions</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;consider</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;possible</span><span 
class="cmtt-10">&#x00A0;states</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;using</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;switch</span><span 
class="cmtt-10">&#x00A0;statement</span><span 
class="cmtt-10">&#x00A0;(see</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;Lab4</span><span 
class="cmtt-10">&#x00A0;assignment</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;example).</span><span 
class="cmtt-10">&#x00A0;Typically,</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;has</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;certain</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;determined</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;carry</span><span 
class="cmtt-10">&#x00A0;out</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;certain</span><span 
class="cmtt-10">&#x00A0;action.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">void</span><span 
class="cmtt-10">&#x00A0;srt_server_init(int</span><span 
class="cmtt-10">&#x00A0;conn);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;initializes</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;marking</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;entries</span><span 
class="cmtt-10">&#x00A0;NULL.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;also</span><span 
class="cmtt-10">&#x00A0;initializes</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;global</span><span 
class="cmtt-10">&#x00A0;variable</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;descriptor</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;conn&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;input</span><span 
class="cmtt-10">&#x00A0;parameter</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;snp_sendseg</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;snp_recvseg.</span><span 
class="cmtt-10">&#x00A0;Finally,</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;starts</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;seghandler</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;to</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;handle</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><span 
class="cmtt-10">&#x00A0;segments.</span><span 
class="cmtt-10">&#x00A0;There</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;only</span><span 
class="cmtt-10">&#x00A0;one</span><span 
class="cmtt-10">&#x00A0;seghandler</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;side</span><span 
class="cmtt-10">&#x00A0;which</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;handles</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;connections</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_server_sock(unsigned</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;port);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;looks</span><span 
class="cmtt-10">&#x00A0;up</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;find</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;first</span><span 
class="cmtt-10">&#x00A0;NULL</span><span 
class="cmtt-10">&#x00A0;entry,</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;creates</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;new</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;using</span><span 
class="cmtt-10">&#x00A0;malloc()</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;entry.</span><span 
class="cmtt-10">&#x00A0;All</span><span 
class="cmtt-10">&#x00A0;fields</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;initialized</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;e.g.,</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;set</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;CLOSED</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;port</span><span 
class="cmtt-10">&#x00A0;set</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;parameter</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;port.</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;index</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;returned</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;new</span><span 
class="cmtt-10">&#x00A0;socket</span><span 
class="cmtt-10">&#x00A0;ID</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;used</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;identify</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;side.</span><span 
class="cmtt-10">&#x00A0;If</span><span 
class="cmtt-10">&#x00A0;no</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;table</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;available</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;returns</span><span 
class="cmtt-10">&#x00A0;-1.</span><br /><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_server_accept(int</span><span 
class="cmtt-10">&#x00A0;sockfd);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;gets</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;pointer</span><span 
class="cmtt-10">&#x00A0;using</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;sockfd</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;changes</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;connetion</span><span 
class="cmtt-10">&#x00A0;to</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;LISTENING.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;starts</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;timer</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;busy</span><span 
class="cmtt-10">&#x00A0;wait&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;until</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB&#8217;s</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;changes</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;CONNECTED</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;(seghandler</span><span 
class="cmtt-10">&#x00A0;does</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;SYN</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received).</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;waits</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;infinite</span><span 
class="cmtt-10">&#x00A0;loop</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;transition</span><span 
class="cmtt-10">&#x00A0;before</span><span 
class="cmtt-10">&#x00A0;proceeding</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;1</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;change</span><span 
class="cmtt-10">&#x00A0;happens,</span><span 
class="cmtt-10">&#x00A0;dropping</span><span 
class="cmtt-10">&#x00A0;out</span><span 
class="cmtt-10">&#x00A0;of</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;busy</span><span 
class="cmtt-10">&#x00A0;wait</span><span 
class="cmtt-10">&#x00A0;loop.</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;can</span><span 
class="cmtt-10">&#x00A0;implement</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;blocking</span><span 
class="cmtt-10">&#x00A0;wait</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;different</span><span 
class="cmtt-10">&#x00A0;ways,</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;wish.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_server_recv(int</span><span 
class="cmtt-10">&#x00A0;sockfd,</span><span 
class="cmtt-10">&#x00A0;void*</span><span 
class="cmtt-10">&#x00A0;buf,</span><span 
class="cmtt-10">&#x00A0;unsigned</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;length);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Receive</span><span 
class="cmtt-10">&#x00A0;data</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;srt</span><span 
class="cmtt-10">&#x00A0;client.</span><span 
class="cmtt-10">&#x00A0;Recall</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;unidirectional</span><span 
class="cmtt-10">&#x00A0;transport</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;where</span><span 
class="cmtt-10">&#x00A0;DATA</span><span 
class="cmtt-10">&#x00A0;flows</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;server.</span><span 
class="cmtt-10">&#x00A0;Signaling/control</span><span 
class="cmtt-10">&#x00A0;messages</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;such</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;SYN,</span><span 
class="cmtt-10">&#x00A0;SYNACK,</span><span 
class="cmtt-10">&#x00A0;etc.flow</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;both</span><span 
class="cmtt-10">&#x00A0;directions.</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;do</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;need</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;implement</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;Lab4.</span><span 
class="cmtt-10">&#x00A0;We</span><span 
class="cmtt-10">&#x00A0;will</span><span 
class="cmtt-10">&#x00A0;use</span><span 
class="cmtt-10">&#x00A0;this</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;Lab5</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;implement</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;Go-Back-N</span><span 
class="cmtt-10">&#x00A0;sliding</span><span 
class="cmtt-10">&#x00A0;window.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;srt_server_close(int</span><span 
class="cmtt-10">&#x00A0;sockfd);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;function</span><span 
class="cmtt-10">&#x00A0;calls</span><span 
class="cmtt-10">&#x00A0;free()</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;free</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;entry.</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;marks</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;entry</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;TCB</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;NULL</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;returns</span><span 
class="cmtt-10">&#x00A0;1</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;succeeded</span><span 
class="cmtt-10">&#x00A0;(i.e.,</span><span 
class="cmtt-10">&#x00A0;was</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;right</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;complete</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;close)</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;-1</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;fails</span><span 
class="cmtt-10">&#x00A0;(i.e.,</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;wrong</span><span 
class="cmtt-10">&#x00A0;state).</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">void</span><span 
class="cmtt-10">&#x00A0;*seghandler(void*</span><span 
class="cmtt-10">&#x00A0;arg);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;started</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;srt_server_init().</span><span 
class="cmtt-10">&#x00A0;It</span><span 
class="cmtt-10">&#x00A0;handles</span><span 
class="cmtt-10">&#x00A0;all</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;segments</span><span 
class="cmtt-10">&#x00A0;from</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client.</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;seghanlder</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;an</span><span 
class="cmtt-10">&#x00A0;infinite</span><span 
class="cmtt-10">&#x00A0;loop</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;calls</span><span 
class="cmtt-10">&#x00A0;snp_recvseg().</span><span 
class="cmtt-10">&#x00A0;If</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;snp_recvseg()</span><span 
class="cmtt-10">&#x00A0;fails</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;closed</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;thread</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;terminated.</span><span 
class="cmtt-10">&#x00A0;Depending</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;state</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;when</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;(based</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;incoming</span><span 
class="cmtt-10">&#x00A0;segment)</span><span 
class="cmtt-10">&#x00A0;various</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;actions</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;taken.</span><span 
class="cmtt-10">&#x00A0;See</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;more</span><span 
class="cmtt-10">&#x00A0;details.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /></div></div>
<!--l. 382--><p class="noindent" >
<h3 class="likesectionHead"><a 
 id="x1-9000"></a>SNP prototypes</h3>
<!--l. 384--><p class="noindent" >In what follows, we provide more details on each of the snp prototypes you will implement. These are just
guidelines you are free to implement the protocol as you like.
<div 
class="colorbox" id="colorbox4"><div class="BVerbatimInput"><br /><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;SNP</span><span 
class="cmtt-10">&#x00A0;API</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;client</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;server</span><span 
class="cmtt-10">&#x00A0;sides</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;=======================================</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;In</span><span 
class="cmtt-10">&#x00A0;what</span><span 
class="cmtt-10">&#x00A0;follows,</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;provide</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;prototype</span><span 
class="cmtt-10">&#x00A0;definition</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;each</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;limited</span><span 
class="cmtt-10">&#x00A0;pseudo</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;representation</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;function.</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;not</span><span 
class="cmtt-10">&#x00A0;meant</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;comprehensive</span><span 
class="cmtt-10">&#x00A0;-</span><span 
class="cmtt-10">&#x00A0;more</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;guideline.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;free</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;design</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;wish.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;NOTE:</span><span 
class="cmtt-10">&#x00A0;snp_sendseg()</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;snp_recvseg()</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;services</span><span 
class="cmtt-10">&#x00A0;provided</span><span 
class="cmtt-10">&#x00A0;by</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;networking</span><span 
class="cmtt-10">&#x00A0;layer</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;i.e.,</span><span 
class="cmtt-10">&#x00A0;simple</span><span 
class="cmtt-10">&#x00A0;network</span><span 
class="cmtt-10">&#x00A0;protocol</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;transport</span><span 
class="cmtt-10">&#x00A0;layer.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;snp_sendseg(int</span><span 
class="cmtt-10">&#x00A0;connection,</span><span 
class="cmtt-10">&#x00A0;seg_t*</span><span 
class="cmtt-10">&#x00A0;segPtr);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Send</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;SRT</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;over</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;network</span><span 
class="cmtt-10">&#x00A0;(this</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;simply</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;single</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;Lab4).</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;sends</span><span 
class="cmtt-10">&#x00A0;data</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;byte</span><span 
class="cmtt-10">&#x00A0;stream.</span><span 
class="cmtt-10">&#x00A0;In</span><span 
class="cmtt-10">&#x00A0;order</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;segments</span><span 
class="cmtt-10">&#x00A0;over</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;connection,</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;delimiters</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;start</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;end</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;packet</span><span 
class="cmtt-10">&#x00A0;must</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;added</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;transmission.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;That</span><span 
class="cmtt-10">&#x00A0;is,</span><span 
class="cmtt-10">&#x00A0;first</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;characters</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;!&amp;&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;indicate</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;start</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;segment;</span><span 
class="cmtt-10">&#x00A0;then</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;seg_t;</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;finally,</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;end</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;packet</span><span 
class="cmtt-10">&#x00A0;markers</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;!#&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;indicate</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;end</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;segment.</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Return</span><span 
class="cmtt-10">&#x00A0;1</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;success,</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;-1</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;failure.</span><span 
class="cmtt-10">&#x00A0;snp_sendseg()</span><span 
class="cmtt-10">&#x00A0;uses</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;send()</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;first</span><span 
class="cmtt-10">&#x00A0;send</span><span 
class="cmtt-10">&#x00A0;two</span><span 
class="cmtt-10">&#x00A0;chars,</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;send()</span><span 
class="cmtt-10">&#x00A0;again</span><span 
class="cmtt-10">&#x00A0;but</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;seg_t,</span><span 
class="cmtt-10">&#x00A0;and,</span><span 
class="cmtt-10">&#x00A0;then</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;send()</span><span 
class="cmtt-10">&#x00A0;two</span><span 
class="cmtt-10">&#x00A0;chars</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;end</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;packet.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><span 
class="cmtt-10">//</span><br /><br /><span 
class="cmtt-10">int</span><span 
class="cmtt-10">&#x00A0;snp_recvseg(int</span><span 
class="cmtt-10">&#x00A0;connection,</span><span 
class="cmtt-10">&#x00A0;seg_t*</span><span 
class="cmtt-10">&#x00A0;segPtr);</span><br /><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Receive</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;over</span><span 
class="cmtt-10">&#x00A0;overlay</span><span 
class="cmtt-10">&#x00A0;network</span><span 
class="cmtt-10">&#x00A0;(this</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;single</span><span 
class="cmtt-10">&#x00A0;TCP</span><span 
class="cmtt-10">&#x00A0;connection</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;case</span><span 
class="cmtt-10">&#x00A0;of</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;Lab4).</span><span 
class="cmtt-10">&#x00A0;We</span><span 
class="cmtt-10">&#x00A0;recommend</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;recieve</span><span 
class="cmtt-10">&#x00A0;one</span><span 
class="cmtt-10">&#x00A0;byte</span><span 
class="cmtt-10">&#x00A0;at</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;time</span><span 
class="cmtt-10">&#x00A0;usin</span><span 
class="cmtt-10">&#x00A0;recv().</span><span 
class="cmtt-10">&#x00A0;Here</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;are</span><span 
class="cmtt-10">&#x00A0;looking</span><span 
class="cmtt-10">&#x00A0;for</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;!&amp;&#8217;&#8217;</span><span 
class="cmtt-10">&#x00A0;characters</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;seg_t</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;then</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;!#&#8217;&#8217;.</span><span 
class="cmtt-10">&#x00A0;This</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;FSM</span><span 
class="cmtt-10">&#x00A0;of</span><span 
class="cmtt-10">&#x00A0;sorts</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;you</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;code</span><span 
class="cmtt-10">&#x00A0;it</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;way.</span><span 
class="cmtt-10">&#x00A0;Make</span><span 
class="cmtt-10">&#x00A0;sure</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;cover</span><span 
class="cmtt-10">&#x00A0;cases</span><span 
class="cmtt-10">&#x00A0;such</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;&#8216;&#8216;#&amp;bbb!b!bn#bbb!#&#8217;&#8217;</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;The</span><span 
class="cmtt-10">&#x00A0;assumption</span><span 
class="cmtt-10">&#x00A0;here</span><span 
class="cmtt-10">&#x00A0;(fairly</span><span 
class="cmtt-10">&#x00A0;limiting</span><span 
class="cmtt-10">&#x00A0;but</span><span 
class="cmtt-10">&#x00A0;simplistic)</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;!&amp;</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;!#</span><span 
class="cmtt-10">&#x00A0;will</span><span 
class="cmtt-10">&#x00A0;not</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;seen</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;data</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;segment.</span><span 
class="cmtt-10">&#x00A0;You</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;read</span><span 
class="cmtt-10">&#x00A0;in</span><span 
class="cmtt-10">&#x00A0;one</span><span 
class="cmtt-10">&#x00A0;byte</span><span 
class="cmtt-10">&#x00A0;as</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;char</span><span 
class="cmtt-10">&#x00A0;at</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;time</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;copy</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;data</span><span 
class="cmtt-10">&#x00A0;part</span><span 
class="cmtt-10">&#x00A0;into</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;buffer</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;be</span><span 
class="cmtt-10">&#x00A0;returned</span><span 
class="cmtt-10">&#x00A0;to</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;caller.</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;IMPORTANT:</span><span 
class="cmtt-10">&#x00A0;once</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;have</span><span 
class="cmtt-10">&#x00A0;parsed</span><span 
class="cmtt-10">&#x00A0;a</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;you</span><span 
class="cmtt-10">&#x00A0;should</span><span 
class="cmtt-10">&#x00A0;call</span><span 
class="cmtt-10">&#x00A0;seglost().</span><span 
class="cmtt-10">&#x00A0;Here</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;code</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;for</span><span 
class="cmtt-10">&#x00A0;seglost():</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;if</span><span 
class="cmtt-10">&#x00A0;segment</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;lost</span><span 
class="cmtt-10">&#x00A0;(we</span><span 
class="cmtt-10">&#x00A0;emulate</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;packet</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;lost</span><span 
class="cmtt-10">&#x00A0;on</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;network)</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;1;</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;otherwise</span><span 
class="cmtt-10">&#x00A0;we</span><span 
class="cmtt-10">&#x00A0;assume</span><span 
class="cmtt-10">&#x00A0;that</span><span 
class="cmtt-10">&#x00A0;the</span><span 
class="cmtt-10">&#x00A0;packet</span><span 
class="cmtt-10">&#x00A0;is</span><span 
class="cmtt-10">&#x00A0;received</span><span 
class="cmtt-10">&#x00A0;OK</span><span 
class="cmtt-10">&#x00A0;and</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;0</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;seglost()</span><span 
class="cmtt-10">&#x00A0;{</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;int</span><span 
class="cmtt-10">&#x00A0;random</span><span 
class="cmtt-10">&#x00A0;=</span><span 
class="cmtt-10">&#x00A0;rand()%100;</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;if(random&#x003C;LOSS_RATE*100)</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;1;</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;else</span><br /><span 
class="cmtt-10">//</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;return</span><span 
class="cmtt-10">&#x00A0;0;</span><br /><span 
class="cmtt-10">//}</span><br /><span 
class="cmtt-10">//</span><br /><span 
class="cmtt-10">//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><br /><br /></div></div>
 
</body></html> 

                                                                                  


